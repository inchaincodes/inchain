package org.inchain.network;

import java.net.InetSocketAddress;

import org.inchain.Configure;
import org.inchain.crypto.Sha256Hash;
import org.inchain.message.DefaultMessageSerializer;
import org.inchain.message.MessageSerializer;
import org.inchain.store.BlockStore;
import org.inchain.utils.Hex;
import org.inchain.utils.Utils;

/**
 * 测试网络
 * @author ln
 *
 */
public class TestNetworkParams extends NetworkParams {

	public TestNetworkParams() {
		seedManager = new RemoteSeedManager();

//		seedManager.addDnsSeed("test1.seed.inchain.org");
//		seedManager.addDnsSeed("test2.seed.inchain.org");

//    	seedManager.add(new Seed(new InetSocketAddress("47.93.16.125", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.249.26", Configure.DEFAULT_PORT)));
//   	seedManager.add(new Seed(new InetSocketAddress("119.23.253.3", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.254.99", Configure.DEFAULT_PORT)));
		seedManager.add(new Seed(new InetSocketAddress("192.168.1.190", Configure.DEFAULT_PORT)));
        seedManager.add(new Seed(new InetSocketAddress("192.168.1.186", Configure.DEFAULT_PORT)));
		init();
	}
    

	public TestNetworkParams(SeedManager seedManager) {
    	this.seedManager = seedManager;
    	init();
	}
    
	private void init() {
		
		id = ID_TESTNET;
		
		packetMagic = 629266570l;
		
		this.acceptableAddressCodes = new int[] {getSystemAccountVersion(), getCertAccountVersion()};
	}
	
	/**
	 * 测试网络的创世块
	 */
	@Override
	public BlockStore getGengsisBlock() {
		BlockStore gengsisBlock = new BlockStore(this, Hex.decode("000000000000000000000000000000000000000000000000000000000000000000000000b1c2936d7aa7059657ae8cb734e9de17caf595dc9e6f05979e4045bfb71461dc756f6359000000000000756f6359822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f3098846304402202ba304bf70dc9787888c2692a5cc51edc5891af12a8dcabaf236eefbd12d7d2c02205ad52abcc5624d02374d3cb11d0f8b1f67a6c0e2c21f08ff1ac52b8b7ed50955ac150101000000010012117468697320612067656e6773697320747800000000010080faca73f91f0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688accf636b2c5d010000000000000000000000020100000001016f6c2b2181d619c1889d7a7581726e27948f60d24a1df53e2ff562de781ca297000000006a47304402204be962d88652fac4c4c6745497b3bc9bb6105f8e2d29f494fedb7af1152ffef8022035164054c8ef830f4e2f35a1b6d22361942b46dfd02251e417a5f39e1d19ee6201210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020080c6a47e8d03000078c2486c0100001976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00003426f56b1c0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac03646b2c5d010000000000000000000000060100000012646b2c5d010000832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988473045022100e3c06d2d3eec597f1e680a8d97681031ef8011f84d60e24ad2fc69e940410c800220250378fd95a28e074b60fc9884bb5d5a3568d7510369b072d840798ab831d14aac4237cccf6ff9a7674a8fc47c60278fdd23e9f3097f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101c6d4ae771f43b1138dcd6132115125dfae92938134113ac99171d47751002c15010000006b483045022100d9df99873e9a1bda0b937cfa14a060abf3199b016b8a210afca11affd655810e022058f34bde916cd41d658aeee7931a661905a089aa23a9ddc4eb7a8a7f3072e8d001210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00c0b91502111c0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac13646b2c5d0100000000000000000000000301000000000015646b2c5d010000000000000000000000832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988473045022100c4b2fcf49f00b14ea39dda87d33f401cacb445bab6e39515798f48415d6e117402205651df21262792b5ee007a81c15c2f032bb398dd94e2685e8eec2b2765f15da7ac15646b2c4237cccf6ff9a7674a8fc47c60278fdd23e9f309060100000026646b2c5d010000832103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d284310091288473045022100a8a1086d0dbc04f9d485538812c832cfb2258f36cb72bc55bab6706f2417895a02206161661fb214773c5b8be4af7b89d99dc0592bdc49c698779ac0cab362354c16ac2c1179b1e05fb8652644f6c61a033d28431009127f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101e9b6bef88454ae01f7739bbd12f4f1c00b2b607c974f18f0d18a4a1f9863aa4a010000006a4730440220690e047486df2baa53462555f95450b6bedccd5555c83251a41d766ef0ac3db1022034995ba27f2dacf4a8d49d22c636b0ad9455cf18534eb370bc1bb51fa9f6dda301210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a9142c1179b1e05fb8652644f6c61a033d284310091288ac00803f050fb61b0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac27646b2c5d0100000000000000000000000301000000000028646b2c5d010000000000000000000000822103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d28431009128846304402206b6c6ef56a57b0210337ab6e9fe3b1aea6d6f8300b4e2b130ccfe5536f08d0fd02207f29632c9f2b6df15ec9e70f74cb6a86f88435b7af9d2217f6b594bdcdf7a173ac28646b2c2c1179b1e05fb8652644f6c61a033d284310091206010000002d646b2c5d0100008321033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88473045022100e7a45b7927bbe5f6b0e164e86386e20a4449ec5130842d8b0a61bded5f6f2af102205c05f570200318e37699ae6f22ae39305f00d0e3fec4c795221c6fe3c3d6e7d1acb3fcd687a5c2b2617de0d504cfa7d12db93bb00c7f969800000000000000000000000000000000000000000000000000000000000000000000000000000201000000010118909b65dcd60ecc933ccb0bc3845170f5165b129119eae4f1d217c8c0ec65e4010000006b483045022100efde85217e96aa403f625c8805253758316b5029e08dfec36c008a0d9313197102201b83b2765980b9e10fc627ed946d93f93ca5b02e21c74cb7d223363bde0893c701210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88ac0040c5f41b5b1b0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac2e646b2c5d010000000000000000000000030100000000002e646b2c5d0100000000000000000000008221033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c884630440220115b6efc404dfa781d032826f61ca24232bf97076a356982b63b3a27f9190a57022020f555b96834d15394e390d9fcf49143a0e24e3d3bb9614a7a9eda3be8eb5836ac2e646b2cb3fcd687a5c2b2617de0d504cfa7d12db93bb00c060100000034646b2c5d010000822103bf7759e9b81f8ff1b99732b3ee36aea0abff68c818b8839c318ad350e9642cb076a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a8884630440220169844df39d7dd35bfa51b556158f9867766165b978e54607ffcfb35f06a73fa022048d1496178796ca3a36e873bf6b74981d0ad38ebb8fc454f967e94f011b4e67facc3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a87f96980000000000000000000000000000000000000000000000000000000000000000000000000000020100000001019e32feb831290e306733129eafd2c5292b32b0834a7aa38a5fec9a8d70cd69f5010000006b483045022100fbd2a1af479da5f43fae1fbcedb0ec8acaef33eeb1fb776a4d91579bcc24e7a8022038d5e009e40934a1fc522d12d190e4de2dc6c2a3056b28a016fde3a754ad8c1a01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a888ac00004be428001b0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac35646b2c5d01000000000000000000000006010000003b646b2c5d01000082210200d482122f8537ad2fa1af1914e088d6b308824a8ef4dc8b68fa0e0a88c484e376a9145f1a078b610d92a3110b2c1a7f880b0d2442e5308846304402202ed824ed7faa2fb06d95b4449a5f9b9f9724a41a7d7a6c4c82c49cf1de5a05f4022073f39e751f6ba85299310c528e6408243aa9935ce245b75fc6b0a2e7dd58d198ac5f1a078b610d92a3110b2c1a7f880b0d2442e5307f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101907174c7929f9ae569ffb0cc0521b7820b53d8e4c3898107e73f39459545bbcb010000006a473044022014bcf3a82e1cd32fb0d95f21da4952856fbf2fe84029fa8af4a546fde0e9133502206062745e6da38eea5fbabcbf4220677bb056d1e5b9d806e0a08ed0e4fdc0ef8c01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a9145f1a078b610d92a3110b2c1a7f880b0d2442e53088ac00c0d0d335a51a0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac3b646b2c5d010000000000000000000000060100000041646b2c5d010000832103e8769d1901a4ef006054405c16716d6648fffe628385db5586c7fa18c3df5da876a914df639c6066a817a6be28b532839f8e1e85594cd488473045022100f6e68aae08961b20513f1e6e44c661b71dce4ec388133f80dd67eb67d889078202207f04be7b4ce25d4c3dd9e27705150bda50fc66cf56b8504d002b00e3afc69b67acdf639c6066a817a6be28b532839f8e1e85594cd47f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101f344b12b99b103ca3eb90c9f1397bf005074ca125031f5a4a7a4bba58002deb8010000006a47304402201ca021a846223f9aa0afa2d5a8c954c0616d21522ff1ce9cab7e6d129ed7bc65022017c7c7ff12e6e589ee58a77a8247c34b726594bf19726f7784cfef054eb6c0f201210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a914df639c6066a817a6be28b532839f8e1e85594cd488ac008056c3424a1a0000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac42646b2c5d010000000000000000000000060100000047646b2c5d010000832103368f8061e02694e37da199c07c3e2f2506cdd748efee493f0d1c52ae7494428f76a914e3453a80144f6ac24baf01f20455c6167b985485884730450221008d4a7dc9c927dbe01f4d973d729c45144195637962590b6f0fc4071d2cf3ec0102206c6667afd47288b79121ce8ac778b1aa5c8febb659578d267004f88852bb596face3453a80144f6ac24baf01f20455c6167b9854857f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101ab2cee4fd62750aaf930e7e66a5b06721a472ca4a18848eb0ec86369bdb67ad6010000006b483045022100fa1ad42106bb02873a3df193c4282c8819efa6f865d4b783a392e6fe50e83a2a02207a5f002d235a5fb7fe710e8ca70195362376e66660635f02310f5252acb9eedb01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200407a10f35a000000000000000000001976a914e3453a80144f6ac24baf01f20455c6167b98548588ac0040dcb24fef190000000000000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac48646b2c5d0100000000000000000000000b010000003887532c5d010000325cb56f9e72ba1a3c729065a8535cb47361902a325cb56f9e72ba1a3c729065a8535cb47361902a00fd23022b046e616d6506e5908de7a7b01ee9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb822076164647265737306e59cb0e59d8012e9878de5ba86e5b882e58d97e5b2b8e58cba44046c6f676f06e59bbee7898737687474703a2f2f66696c652e696e636861696e2e6f72672f696d616765732f696e636861696e5f6c6f676f5f313030783130302e706e672b0a637265646974436f64650ce4bfa1e794a8e4bba3e7a0811239313530303130384d41355542333248334e1a0570686f6e6506e794b5e8af9d0c3032332d383633333130363927077765627369746506e5ae98e7bd911768747470733a2f2f7777772e696e636861696e2e6f7267fd1d0108646573637269707406e68f8fe8bfb0fd0a01e9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb8e698afe4b880e5aeb6e4bba5e58cbae59d97e993bee68a80e69cafe9a9b1e58aa8e79a84e5889be696b0e59e8be4bc81e4b89aefbc8ce585b6e4b8bbe5afbce79a84e58cbae59d97e993bee7a4bee58cbae9a1b9e79bae496e636861696e2de58db0e993bee698afe4b880e4b8aae4bba5e998b2e4bcaae4b8bae59fbae7a180e4b89ae58aa1e79a84e585ace5bc80e5b9b3e58fb0efbc8ce4b8bae7a4bee4bc9ae59084e4bc81e4b89ae38081e69cbae69e84e38081e889bae69cafe5aeb6e7ad89e68f90e4be9be59381e7898ce38081e79fa5e8af86e4baa7e69d83e4bf9de68aa4e69c8de58aa1e3808202210303bdd8c161cef724d68eea36bc2202bec3dc55ac8e903e1e9dd08c54f958edac21029d3530486845b04ef5b20fb564c4291db09c472258d04254f1c83f90b692e7f9012103a921ac3da8136ab9271db98b5f193a5a298a45bf5a481bcca1df1c4b029ed2d282c220a347f881b9ee28829814a1fbe161a747eec5c53d133237a1fa42b0d61899ddf8c314716b68dd463d01263a7ff4a7c52eae528d71439688473045022100f55c7d52010367f43340dc5165c92e0264321c37b898c797a8d886ca848027aa022071fddcfc047cf5e50c6d80ad5062e0501cfdfe3404d8b2984bf4e78f526749c9ac0b010000007ea5692c5d010000f122d44fdff22c61c1d78f6619cbee4452283afd325cb56f9e72ba1a3c729065a8535cb47361902a01fd24012b046e616d6506e5908de7a7b01ee9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb822076164647265737306e59cb0e59d8012e9878de5ba86e5b882e58d97e5b2b8e58cba44046c6f676f06e59bbee7898737687474703a2f2f66696c652e696e636861696e2e6f72672f696d616765732f696e636861696e5f6c6f676f5f313030783130302e706e672b0a637265646974436f64650ce4bfa1e794a8e4bba3e7a0811239313530303130384d41355542333248334e1a0570686f6e6506e794b5e8af9d0c3032332d383633333130363927077765627369746506e5ae98e7bd911768747470733a2f2f7777772e696e636861696e2e6f72672008646573637269707406e68f8fe8bfb00fe8b4a6e688b7e7aea1e79086e59198022103142ed97fcbed8c9c89d967979ad8a08d3d802033918ea22264fff51865b8ea832102304e16c263b94e0e8dcc9e241190ce5fce141373590efa21769a165fd8c561a4012103fa566f9aaf446e07d421b9a8d9b01b10dd893f406b5ea0f83890d02582b0396482c220be0408f67a740ced7d7d1e2a0d1297e1161f869ef3aff2a816d41a09f9c21fe3c314481e05c83604abf86cca029c4260674c45c85c5888473045022100f4d3dd40bbf7fa1866e39378ff3a295912fe404aef635a959bf320d0c205011b022065ea90ffd8674dbaa039cc1f8d066789a5551be3e2f4691ce38b2d72a15f60f5ac"));

		Sha256Hash merkleHash = gengsisBlock.getBlock().buildMerkleHash();

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block merkle hash is : {}", merkleHash);
		}
		Utils.checkState("b1c2936d7aa7059657ae8cb734e9de17caf595dc9e6f05979e4045bfb71461dc".equals(Hex.encode(merkleHash.getBytes())), "the gengsis block merkle hash is error");

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block hash key is : {}", gengsisBlock.getBlock().getHash());
		}
		Utils.checkState("709453e507a13c54fcded1f22ef9134dd11c4f46aad8a681f90030e681e4cc9d".equals(Hex.encode(gengsisBlock.getBlock().getHash().getBytes())), "the gengsis block hash is error");

		return gengsisBlock;
	}
	
	@Override
	public int getProtocolVersionNum(ProtocolVersion version) {
		return version.getVersion();
	}

	@Override
	public MessageSerializer getSerializer(boolean parseRetain) {
		return new DefaultMessageSerializer(this);
	}

	/**
	 * 获取该网络的认证管理账号的hash160
	 * @return byte[]
	 */
	@Override
	public byte[] getCertAccountManagerHash160() {


		//return Hex.decode("8e168bb4963f0523b9ee1c734d3c142976581930");//root
		//return Hex.decode("b326aeb9c6710864441b7c6a282ce924b4c31749");//manager
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	@Override
	public byte[] getCommunityManagerHash160() {
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	/**
	 * 测试网络，普通地址以t开头
	 */
	@Override
	public int getSystemAccountVersion() {
		return 128;
	}

	/**
	 * 测试网络，认证地址以c开头
	 */
	@Override
	public int getCertAccountVersion() {
		return 88;
	}
}
